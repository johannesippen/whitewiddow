<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="format-detection" content="telephone=no">
    <link rel="stylesheet" href="font/flaticon.css">
    <link rel="stylesheet" href="css/app.css">
    <link rel="stylesheet" href="css/bubbles.css">
    <link rel="stylesheet" href="css/permissions.css">
    <link rel="stylesheet" href="css/swipeslide.css">
    <style>
      .debug {
        height: auto;
        min-height: 0;
        padding: 20px 0;
      }
      .debug a,
      .debug strong {
        display: block;
        background: #789;
        margin: 5px 14px;
        text-align: center;
        line-height: 33px;
        color: #fff;
      }
      .debug .done {
        font-weight: normal;
        color: #567;
        background: transparent;
      }
      #log {
        background: lightyellow;
        overflow: scroll;
        max-height: 150px;
        padding: 5px 20px;
      }
      a.fb {
        background: #3b5998;
      }
      .done:before {
        content: "\2714  ";
      }
      h1, h2, ul {
        margin-top: 0;
      }
    </style>
    <link rel="stylesheet" href="css/modes.css">
    <link rel="stylesheet" href="css/status.css">
    <style id="search_style"></style>
  </head>
  <body class="ios" data-mode="" data-status="">
    <!-- Friend List -->
    <section id="friends">
      <header>
        <h1>Midddle</h1>
      </header>
      <div class="status_selector">
      </div>
      <div class="friends">
        <ul id="friendlist" class="friendlist">
          <li class="friend_slot empty"><img src="img/lock-icon-2x.png"></li>
          <li class="friend_slot" id="friendlist_add"><img src="img/lock-icon-2x.png"></li>
          <li class="friend_slot empty"><img class="ajax" src="img/ajax-loader.gif"></li>
          <li class="friend_slot empty"><img class="ajax" src="img/ajax-loader.gif"></li>
          <li class="friend_slot empty"><img class="ajax" src="img/ajax-loader.gif"></li>
          <li class="friend_slot empty"><img class="ajax" src="img/ajax-loader.gif"></li>
          <li class="friend_slot empty"><img class="ajax" src="img/ajax-loader.gif"></li>
        </ul>
      </div>
      <div class="status_selector">
        <a id="status_busy" class="status_busy">Busy</a>
        <a id="status_free" class="status_free">I&rsquo;m Free</a>
      </div>
    </section>
    <!-- Pre Event Dashboard -->
    <section id="event">
      <header>
        <h1>Midddle</h1>
      </header>
      <div class="invite_dialogue">
        <div class="invite_map">
          <img src="" id="map" class="map">
        </div>
        <div class="event_details">
          <div class="invite_venue">
            <span class="invite_venue_name">%Venue%</span>
            <span class="invite_venue_distance">%0.0km%</span>
          </div>
          <div class="event_time">%20:00%</div>
        </div>
        <div class="invite_more_friends">
          <button><i class="flaticon-user7"></i> Add Friends</button>
        </div>
      </div>
    </section>
    <!-- Peer Invite Dashboard -->
    <section id="received">
      <header>
        <h1>Midddle</h1>
      </header>
      <div class="invite_dialogue">
        <div class="invite_map">
          <img src="" id="map" class="map">
        </div>
        <div id="owl-venues" class="event_details owl-carousel">
          <div class="invite_venue">
            <span class="invite_venue_name">%Venue%</span>
            <span class="invite_venue_distance">%0.0km%</span>
          </div>
          <div class="invite_venue">
            <span class="invite_venue_name">%Venue%</span>
            <span class="invite_venue_distance">%0.0km%</span>
          </div>
          <div class="invite_venue">
            <span class="invite_venue_name">%Venue%</span>
            <span class="invite_venue_distance">%0.0km%</span>
          </div>
          <div class="invite_venue">
            <span class="invite_venue_name">%Venue%</span>
            <span class="invite_venue_distance">%0.0km%</span>
          </div>
        </div>
        <div class="invite_confirm">
          <input type="time" id="set_time_selector">
          <button id="set_time">Set Time &amp; Accept</button>
        </div>
      </div>
    </section>
    <!-- Invite Dialogue -->
    <section id="invite">
      <header>
        <button class="back">Back</button>
        <h1>Midddle</h1>
      </header>
      <div class="invite_dialogue">
        <div class="invite_map">
          <img src="" id="map" class="map">
        </div>
        <div class="invite_venue">
          <span class="invite_venue_name">%Venue%</span>
          <span class="invite_venue_distance">%0.0km%</span>
        </div>
        <!-- div class="invite_venue" id="venue_slider">
          <ul>
            <li>
              <span class="invite_venue_name">%Venue%</span>
              <span class="invite_venue_distance">%0.0km%</span>
            </li>
            <li>
              <span class="invite_venue_name">%Venue%</span>
              <span class="invite_venue_distance">%0.0km%</span>
            </li>
          </ul>
          <span class="invite_venue_name">%Venue%</span>
          <span class="invite_venue_distance">%0.0km%</span>
        </div -->
        <div class="invite_confirm">
          <a class="button">Send Invite</a>
        </div>
      </div>
    </section>
    <!-- Venue Details -->
    <section id="venue">
      <header>
        <button class="back">Back</button><h1>MeetEm</h1>
      </header>
      <div class="venue_details">
        <div class="venue_image">
        </div>
        <div class="venue_venue">
          <span class="invite_venue_name">%Venue%</span>
          <span class="invite_venue_distance">%0.0km%</span>
        </div>
        <div class="venue_hours">
          <span class="venue_hours_title venue_title">Opening Hours</span>
          <span class="venue_hours_hours">Today open til 10pm</span>
        </div>
        <div class="venue_contact">
          <span class="venue_contact_title venue_title">Contact</span>
          <div class="venue_contact_actions">
            <a>Call</a>
            <a>Website</a>
          </div>
        </div>
      </div>
    </section>
    <!-- Add Friends -->
    <section id="addfriends">
      <header class="noscroll">
        <input id="search" type="search" placeholder="Search"><button id="addfriends_cancel">Done</button>
      </header>
      <div class="addfriends_list">
        <ul class="fb_friend_list" id="fb_list">
          <li class="fb_divider" id="fb_pending">Pending:</li>
          <li class="fb_divider" id="fb_accept">Invitations from:</li>
          <li class="fb_divider" id="fb_friends">Facebook Friends:</li>
        </ul>
      </div>
      <div class="friend_slots noscroll">
        <div class="friend_slot"><div class="symbol"><img src="img/user-icon-2x.png"></div></div>
        <div class="friend_slot"><div class="symbol"><img src="img/user-icon-2x.png"></div></div>
        <div class="friend_slot"><div class="symbol"><img src="img/user-icon-2x.png"></div></div>
        <div class="friend_slot"><div class="symbol"><img src="img/user-icon-2x.png"></div></div>
        <div class="friend_slot"><div class="symbol"><img src="img/user-icon-2x.png"></div></div>
      </div>
    </section>
    <section id="permissions">
      <section id="welcome" class="permission">
        <div class="permission_description">
          <p>Welcome to Midddle - you are halfway there!</p>
        </div>
        <div class="permission_action">
          <button style="font-family: HelveticaNeue-CondensedBold;">Facebook Connect</button>
        </div>
      </section>
      <section id="allowLocation" class="permission">
        <div class="permission_description">
          <p>Midddle finds the best places for you and your friends to meet.</p>
        </div>
        <div class="permission_action">
          <button>Allow Location</button>
        </div>
      </section>
      <section id="allowNotification" class="permission">
        <div class="permission_description">
          <p>We tell you when you're friends are available.</p>
        </div>
        <div class="permission_action">
          <button>Allow Notification</button>
        </div>
      </section>
      <section id="addFriends" class="permission">
        <div class="permission_description">
          <p>Now, add some Friends!</p>
        </div>
        <div class="permission_action">
          <button>Invite them</button>
        </div>
      </section>
    </section>
    <div style="padding-top: 568px;">
    <!-- Debug Menu -->
    <div style="position: absolute;z-index:32000;top:0;right:140px;background:rgba(0,0,0,.2)">
      <a style="display:inline-block;margin:5px;padding:10px;background:rgba(0,0,0,.3)" onclick="window.location.reload();">&#8635;</a><a style="display:inline-block;margin:5px;padding:10px;background:rgba(0,0,0,.3)" onclick="localStorage.removeItem('permissions');window.location.reload();">&otimes;</a>
    </div>
      <p id="log">
        <!-- Generated Logs go here -->
      </p>
    <script src="js/native/NativeConnector.js"></script>
    <script src="js/native/Social.js"></script>
    <script src="js/native/CoreLocation.js"></script>
    <script src="js/native/PushNotification.js"></script>
    <script src="js/zepto.min.js"></script>
    <script src="js/permissions.js"></script>
    <script src="js/swipeslide.js"></script>
    <script src="js/friends.js"></script>
    <script src="js/interface.js"></script>
    <script src="js/modes.js"></script>
    <script src="js/status.js"></script>
    <script src="js/daytime.js"></script>
    <script src="js/location.js"></script>
    <script src="js/profile.js"></script>
    <script src="js/app.js"></script>
    <script src="js/search.js"></script>
    <script>
      var connector = new NativeConnector();
      var social = new Social();
      var coreLocation = new CoreLocation();
      
      var activate_daytime = false;
      var friend_coordinates = [52.52585,13.341351];
      var my_coordinates = [52.490278,13.47];
      var map = document.getElementById('map'); 

      /* Write Log */
      var writeLog = function(msg) {
        document.getElementById("log").innerHTML += new Date().getTime()+" "+msg+"<br/>";
      };
      /* Facebook Connect */
      var hasAccessToContacts = function() {
        social.addNativeListener("connectFB", _onHasAccessReceived);
        social.connectFB();
        $('.fb').addClass('done');
      };
      var _onHasAccessReceived = function(data) {
        // TODO: not being fired
        log.innerHTML = "HasAccess: "+data.connectionState;
        writeLog("HasAccess: "+data.connectionState);
      };
      /* Get User Location */
      var allowCoreLocation = function() {
        coreLocation.addNativeListener("authorizeCoreLocation", _onCoreLocationAllowed);
        coreLocation.authorizeCoreLocation();
        $('#allowCoreLocation').addClass('done');
      };
      var testCoreLocation = function() {
        coreLocation.addNativeListener("getLocation", _onCoreLocationReceived);
        coreLocation.getLocation();
      };
      var _onCoreLocationAllowed = function(data) {
        writeLog('works!'); //TODO: Why doesn't this work?
      }
      var _onCoreLocationReceived = function(data) {
        log.innerHTML = JSON.stringify(data);
        writeLog(JSON.stringify(data));
        my_coordinates = [data.latitude,data.longitude];
        /*map.src = staticMapUrl(my_coordinates,friend_coordinates,320,320);
        getVenue(getMidpoint(my_coordinates,friend_coordinates),true);*/
      };
      /* Cet Contacts / Invite Friends */
      var inviteFBUser = function() {
        social.addNativeListener("getInvitedUser", _onContactsReceived);
        social.getInvitedUser();
      };
      var getInvitations = function() {
        social.addNativeListener("getConnectedFBContacts", _onContactsReceived);
        social.getInvitedUser();
      };
      var _onContactsReceived = function(data) { // TODO: This callback is not fired, why? You didn't call the method. 
        log.innerHTML = data;
        writeLog(data);
      };
      $(function(){
        $('.invite_venue, .invite_venue_switch a').on('click',function(){
          $('.invite_venue_switch').toggleClass('active');
        });
        loadProfile();
      });
    </script>
  </body>
</html>